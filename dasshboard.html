<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CUADRE - Dashboard</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(135deg,#1e3c72,#7e22ce);
  padding:20px;
}
.container{max-width:1400px;margin:auto}
.card{
  background:#fff;
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.title{
  font-size:22px;
  font-weight:800;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.box{
  background:#f4f6ff;
  border-radius:10px;
  padding:12px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.label{font-size:13px;color:#555}
.value{font-weight:800;font-size:14px}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
thead{
  background:linear-gradient(135deg,#667eea,#764ba2);
}
th{
  color:#fff;
  font-size:12px;
  padding:10px;
  text-align:left;
  text-transform:uppercase;
}
td{
  padding:10px;
  font-size:13px;
  border-bottom:1px solid #eee;
}
tbody tr:hover{background:#f6f8ff}
.amount{font-weight:700;color:#10b981}

@media(max-width:768px){
  .header{flex-direction:column;gap:10px}
}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="card header">
  <div class="title">CUADRE</div>
  <div id="Fecha"></div>
</div>

<!-- INFORMACIÓN GENERAL -->
<div class="card">
  <h3>Información General</h3><br>
  <div class="grid">
    <div class="box"><span class="label">Usuario</span><span id="Usuario" class="value"></span></div>
    <div class="box"><span class="label">Ruta</span><span id="Ruta" class="value"></span></div>
    <div class="box"><span class="label">ID Inicio</span><span id="IdInicio" class="value"></span></div>
  </div>
</div>

<!-- RESUMEN -->
<div class="card">
  <h3>Resumen</h3><br>
  <div class="grid">
    <div class="box"><span class="label">Valor a Cobrar</span><span id="ValorACobrar" class="value"></span></div>
    <div class="box"><span class="label">Valor Cobrado</span><span id="ValorCobrado" class="value"></span></div>
    <div class="box"><span class="label">Pagos</span><span id="Pagos" class="value"></span></div>
    <div class="box"><span class="label">Atrasos</span><span id="At" class="value"></span></div>
  </div>
</div>

<!-- INGRESOS RELACIONADOS -->
<div class="card">
  <h3>Ingresos Relacionados</h3>

  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Crédito</th>
        <th>Ingreso</th>
        <th>Atraso</th>
        <th>Sanción</th>
        <th>Saldo</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="6">Cargando…</td></tr>
    </tbody>
  </table>
</div>

</div>

<script>
// ---------- DATOS FIJOS (URL) ----------
const p = new URLSearchParams(location.search);
const set = (id,v)=>{const e=document.getElementById(id);if(e)e.textContent=v||''};

set('Usuario',p.get('Usuario'));
set('Ruta',p.get('Ruta'));
set('IdInicio',p.get('IdInicio'));
set('ValorACobrar',p.get('ValorACobrar'));
set('ValorCobrado',p.get('ValorCobrado'));
set('Pagos',p.get('Pagos'));
set('At',p.get('At'));
set('Fecha',p.get('Fecha'));

// ---------- INGRESOS RELACIONADOS ----------
async function cargarIngresos(){
  const idInicio = p.get("IdInicio");
  if(!idInicio) return;

  const res = await fetch(
    "https://TU_DOMINIO/ingresos.php?IdInicio=" +
    encodeURIComponent(idInicio)
  );

  const data = await res.json();
  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  if(data.length === 0){
    tbody.innerHTML = "<tr><td colspan='6'>Sin registros</td></tr>";
    return;
  }

  data.forEach(r=>{
    tbody.innerHTML += `
      <tr>
        <td>${r.fecha}</td>
        <td>${r.credito}</td>
        <td>${r.ingreso ?? '-'}</td>
        <td>${r.atraso}</td>
        <td>${r.sancion ?? '-'}</td>
        <td class="amount">${r.saldoi}</td>
      </tr>
    `;
  });
}

cargarIngresos();
</script>

</body>
</html>
