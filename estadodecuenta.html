<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta de Cr√©dito</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Segoe UI, Tahoma, sans-serif;
    background:#eef2f7;
    margin:0;
}
.container{
    max-width:900px;
    margin:40px auto;
    background:#fff;
    padding:25px;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
}
h1{
    text-align:center;
    color:#2c3e50;
}
.search{
    display:flex;
    gap:10px;
    margin-bottom:25px;
}
.search input{
    flex:1;
    padding:12px;
    font-size:16px;
}
.search button{
    padding:12px 22px;
    background:#3498db;
    border:none;
    color:white;
    font-size:16px;
    border-radius:6px;
    cursor:pointer;
}
.card{
    border:1px solid #ddd;
    border-radius:10px;
    padding:20px;
    margin-top:20px;
}
.label{
    font-weight:bold;
    color:#555;
}
.list{
    margin:8px 0 15px 15px;
}
.list li{
    margin-bottom:4px;
}
.loading{
    text-align:center;
    display:none;
}
.error{
    text-align:center;
    color:red;
}
</style>
</head>

<body>

<div class="container">
    <h1>Consulta de Cr√©dito</h1>

    <div class="search">
        <input type="text" id="credito" placeholder="N√∫mero de cr√©dito">
        <button onclick="buscar()">Buscar</button>
    </div>

    <div class="loading" id="loading">Consultando...</div>
    <div class="error" id="error"></div>

    <div id="resultado"></div>
</div>

<script>
const APP_ID = "TU_APP_ID_AQUI"; // üî¥ CAMBIA ESTO
const API_KEY = "V2-mo67y-hHGRh-UQpNZ-lh1L6-Ptx1j-lyHKe-M5n2b-hcQHK";
const TABLE = "ingresos";

async function buscar(){
    const credito = document.getElementById("credito").value.trim();
    if(!credito){
        alert("Ingrese el cr√©dito");
        return;
    }

    document.getElementById("loading").style.display="block";
    document.getElementById("error").innerText="";
    document.getElementById("resultado").innerHTML="";

    const body = {
        Action: "Find",
        Properties: {},
        Rows: [{ credito }]
    };

    try{
        const res = await fetch(
            `https://api.appsheet.com/api/v2/apps/${APP_ID}/tables/${TABLE}/Action`,
            {
                method:"POST",
                headers:{
                    "Content-Type":"application/json",
                    "ApplicationAccessKey": API_KEY
                },
                body: JSON.stringify(body)
            }
        );

        const data = await res.json();
        document.getElementById("loading").style.display="none";

        if(!data || data.length === 0){
            document.getElementById("error").innerText="No hay registros";
            return;
        }

        // Tomamos datos generales del primer registro
        const base = data[0];

        // Construimos listas
        const fechas = data.map(d => d.fecha).filter(Boolean);
        const ingresos = data.map(d => d.ingreso).filter(Boolean);

        document.getElementById("resultado").innerHTML = `
            <div class="card">
                <p><span class="label">Nombre:</span> ${base.nombre || ""}</p>
                <p><span class="label">Cr√©dito:</span> ${base.credito}</p>
                <p><span class="label">Ruta:</span> ${base.rutai || ""}</p>

                <p class="label">Fechas registradas</p>
                <ul class="list">
                    ${fechas.map(f => `<li>${f}</li>`).join("")}
                </ul>

                <p class="label">Ingresos</p>
                <ul class="list">
                    ${ingresos.map(i => `<li>$ ${i}</li>`).join("")}
                </ul>
            </div>
        `;

    }catch(e){
        document.getElementById("loading").style.display="none";
        document.getElementById("error").innerText="Error consultando AppSheet";
        console.error(e);
    }
}
</script>

</body>
</html>
